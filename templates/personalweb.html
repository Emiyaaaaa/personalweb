{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Emiya</title>
	<link rel="icon" type="image/png" href="/media/{{ website_icon }}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/font.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/color.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/left/left.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/middle/matter0.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/middle/matter1.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/middle/matter2.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/middle/matter3.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/middle/window.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/middle/markdown.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'css/middle/bubbly-button.css' %}">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
	<script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
</head>
<body>
	<div class="left" id="left">
		<div class="left-avatar">
			<a href="javascript:void(0)">
				<img src="/media/{{ avatar }}" width="150" height="140"/>
			</a>
		</div>
		<div class="left-menu" id="left-menu">
			<ul>
	            <li id="li-0" data-toggle="collapse">
					<a href="#codeDiary" id="codeDiary">开发笔记</a>
	            </li>
	            <li id="li-1" data-toggle="collapse">
					<a href="#diary" id="diary">我的动态</a>
	            </li>
	            <li id="li-2" data-toggle="collapse">
	            	<a href="#application" id="application">我的应用</a>
	            </li>
	            <li id="li-3" data-toggle="collapse">
					<a href="#personalCenter" id="personalCenter">关于我<span class="line-through">们</span></a>
	            </li>
	        </ul>
		</div>
		<div class="beian"><a href="http://www.miitbeian.gov.cn/" target="_blank">晋ICP备18012113号-1</a></div>
	</div>
    <div class="middle" id="middle">
        <div id="matter0" class="matter0 codeDiary" style="display: none;">
            <ul>
            </ul>
        </div>
        <div id="matter1" class="matter1 diary" style="display: none;">
			<ul>
            </ul>
        </div>
		<div id="matter2" class="matter2" style="display: none">
			<p>项目尚未开发完成，bug反馈或提意见请留言，希望可以留下您的联系方
				<br>式或联系邮箱emiya@emiya.com.cn, Thanks♪(･ω･)ﾉ </p>
			<input type="text" id="message" placeholder="留言(必填)" />
			<input type="text" id="contact" placeholder="联系方式(非必填)" />
            <button class="btn" tpye = "submit" onclick="submitMessage()">提交</button>
            <p><br>已知bug：点开窗口后，部分窗口评论部分不会停靠在底部，正在修复中...<br>ps：请先忽略丑陋的字体</p>
        </div>
        <div id="matter3" class="matter3" style="display: none">
        	<nav class="personalCenter-menu">
        		<ul>
        			<li id="hli-0" data-toggle="collapse">
        				<a href="javascript:void(0)">网站简介</a>
        			</li>
        			<li id="hli-1" data-toggle="collapse">
        				<a href="javascript:void(0)">开发人员</a>
        			</li>
        			<li id="hli-2" data-toggle="collapse">
        				<a href="javascript:void(0)">联系我们</a>
        			</li>
        			<li id="hli-3" data-toggle="collapse">
        				<a href="javascript:void(0)">反馈建议</a>
        			</li>
        		</ul>
        	</nav>
			<span class="target"></span>
	    </div>
    </div>
    <div id="windowBackground" class="windowBackground"></div>
    <div id='window' class="openWindow"></div>
    <script type="text/javascript">
		URLHREF = window.location.href
		MAINURL = URLHREF.split('#')[0]
		URLHASH = URLHREF.split('?')[0].split('/')[3]
		if (URLHASH == ''){
			URLHASH = '#codeDiary'
		}
		try{
			LINUM = $(URLHASH).parent().attr('id').split('-')[1]
		}
		catch(err){
			window.location.href = MAINURL + '404'
		}
		var clientWidth = document.documentElement.clientWidth
		var textWidth = Math.round((Math.round(clientWidth*0.55)-19)*0.8-20)
		var letter_spacing = 2
		var font_size = 15
		TEXTMAXLENGTH = Math.floor((textWidth+letter_spacing)/(letter_spacing+font_size))
		// TEXMAXLENGTH = 37
		nowMatter = 'matter0'
    </script>
    <script type="text/javascript" src="{% static 'js/main.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/ajax.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/window.js' %}"></script>
    <script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
	<script type="text/javascript">
		(function (){
			function json2str(data){
				var date = data.date_chi
				if (date == ''){
					date = data.date
				}
				if (parseInt(data.tem_day) > parseInt(data.tem_night)){
					var tem = data.tem_night + '~' + data.tem_day + '°C'
				}
				else if (parseInt(data.tem_day) < parseInt(data.tem_night)){
					var tem = data.tem_day + '~' + data.tem_night + '°C'
				}
				else{
					var tem = data.tem_day + '°C'
				}

				if (data.weather_day == data.weather_night){
					var weather = data.weather_day
				}
				else{
					var weather = data.weather_day + '转' + data.weather_night
				}

				var wdp = data.wdp_day
				return {'weather':weather,'tem':tem,'date':date,'wdp':wdp}
			}
			$.ajax({
				type: 'POST',
				url: 'http://api.shujuzhihui.cn/api/weather/ip',
				data: {'appKey':'9057ff088d24450b93d896cf317835f4','ip':returnCitySN["cip"],'n7':1},
				success:function(data){
					if (data.ERRORCODE == '0'){
						var city = data.RESULT.area_maybe
						if (city = []){
							var area = data.RESULT.areaInfo
							city = area.county + area.province + area.city
						}
						var d1 = data.RESULT.weatherInfo.n7.d1
						var d2 = data.RESULT.weatherInfo.n7.d2
						var d3 = data.RESULT.weatherInfo.n7.d3
						var day1 = json2str(d1)
						var day2 = json2str(d2)
						var day3 = json2str(d3)
						console.log(city)
						console.log(day1.date+': '+day1.weather+' '+day1.tem+' '+day1.wdp)
						console.log(day2.date+': '+day2.weather+' '+day2.tem+' '+day2.wdp)
						console.log(day3.date+': '+day3.weather+' '+day3.tem+' '+day3.wdp)
						console.log(data)
					}
					else{
						console.log('error:'+data.ERRORCODE+' result:'+data.RESULT)
					}
	        	}
	    	})
		})()
	</script>
</body>
</html>